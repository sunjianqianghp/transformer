`torch.Tensor.gather` 是 PyTorch 中一个非常强大的方法，它可以**从张量中按指定维度和索引提取数据**。这个操作在处理分类、序列任务、attention 等场景中非常常见。

---

## 🧩 作用简述

**`tensor.gather(dim, index)`：从 `tensor` 的指定维度 `dim` 上，根据 `index` 中的索引，提取对应的元素。**

你可以把它理解成：**“在 dim 维度上，用 index 指定每个位置要选哪个元素。”**

---

## 🧠 函数签名

```python
torch.Tensor.gather(dim, index) → Tensor
```

| 参数      | 说明                                                           |
| ------- | ------------------------------------------------------------ |
| `dim`   | 指定在哪个维度上进行索引选择                                               |
| `index` | 一个与 `input` 相同 shape 的张量，其中的每个元素表示要从 `input` 的 `dim` 维上选取的索引 |

---

## ✅ 示例说明（二维）

### 示例 1：二维张量按行提取元素

```python
import torch

# 原始 tensor
x = torch.tensor([[10, 20, 30],
                  [40, 50, 60]])

# 指定按行选取：每行选出一个元素，指定列索引
index = torch.tensor([[2, 1, 0],
                      [0, 2, 1]])

# 在 dim=1（列维）上进行 gather
result = x.gather(dim=1, index=index)

print(result)
```

### 输出结果：

```
tensor([[30, 20, 10],
        [40, 60, 50]])
```

#### 解释：

* 第一行：x\[0]\[2], x\[0]\[1], x\[0]\[0] → 30, 20, 10
* 第二行：x\[1]\[0], x\[1]\[2], x\[1]\[1] → 40, 60, 50

---

## 📌 应用场景举例

### 🧠 多分类模型：从模型输出中提取预测概率

```python
logits = torch.tensor([[0.1, 0.7, 0.2],
                       [0.3, 0.4, 0.3]])  # shape: [2, 3]

target = torch.tensor([[1], [2]])  # 每个样本的类别（索引）

# 提取每个样本对应类别的概率
probs = logits.gather(dim=1, index=target)

print(probs)  # tensor([[0.7], [0.3]])
```

---

## 🧮 工作机制图示（行方向示意）

对于：

```python
x = [[10, 20, 30],
     [40, 50, 60]]

index = [[2, 1, 0],
         [0, 2, 1]]
```

你可以把 gather 看作：

* 每行按 `index` 指定的列位置，从 `x` 中选出对应元素

---

## ⚠️ 注意事项

| 注意点                            | 说明                      |
| ------------------------------ | ----------------------- |
| `index` 的 shape 必须与输出 shape 一致 | 它告诉 `gather` 每个位置要取哪个索引 |
| `dim` 是你操作的维度                  | 通常对分类来说是 `dim=1`（类别维）   |
| 常用于分类、注意力、选择操作等                | 如 softmax 输出中提取指定类的得分   |

---

## ✅ 总结

| 功能     | 从指定维度上根据索引提取数据                  |
| ------ | ------------------------------- |
| 常用场景   | 分类预测提取、注意力权重处理、mask、序列任务        |
| 参数要求   | `index` 与 `input` 同形状，表示每个位置的索引 |
| 推荐使用维度 | 多分类时：dim=1（类别维）                 |

---

如果你有具体场景（比如：从 RNN 的输出中提取每个样本的最终时间步，或 attention 选择 top-k），我可以写一个更详细的 demo。是否需要？
